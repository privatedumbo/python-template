---
description: Testing patterns for Copier template projects
globs: ["tests/**/*.py"]
alwaysApply: false
---

# Template Testing

## Test Structure

Tests verify that the Copier template generates valid projects.

```python
from copier import run_copy

def test_feature(template_path: Path, tmp_path: Path) -> None:
    run_copy(
        str(template_path),
        tmp_path,
        data={"project_slug": "test", ...},
        unsafe=True,  # Required for local templates
    )

    # Assert generated files exist and have correct content
    assert (tmp_path / "expected_file.py").exists()
```

## Common Test Patterns

### Testing Conditional Features
```python
def test_feature_enabled(template_path, tmp_path):
    run_copy(..., data={..., "include_feature": True})
    assert (tmp_path / "feature_file").exists()

def test_feature_disabled(template_path, tmp_path):
    run_copy(..., data={..., "include_feature": False})
    assert not (tmp_path / "feature_file").exists()
```

### Testing Generated Content
```python
def test_variable_substitution(template_path, tmp_path):
    run_copy(..., data={"project_slug": "my_project"})
    content = (tmp_path / "pyproject.toml").read_text()
    assert 'name = "my_project"' in content
```

### Testing Generated Project Validity
```python
def test_project_passes_validation(template_path, tmp_path):
    run_copy(...)

    # Sync deps and run checks
    subprocess.run(["uv", "sync"], cwd=tmp_path, check=True)
    subprocess.run(["uv", "run", "ruff", "check", "."], cwd=tmp_path, check=True)
    subprocess.run(["uv", "run", "mypy", "."], cwd=tmp_path, check=True)
```

## Fixtures

```python
@pytest.fixture
def template_path() -> Path:
    return Path(__file__).parent.parent

@pytest.fixture
def default_answers() -> dict[str, str | bool]:
    return {
        "project_slug": "test_project",
        # ... all required answers
    }
```

## Best Practices

- Test all boolean option combinations
- Verify generated project passes its own tests
- Check both file existence and content
- Use `tmp_path` fixture for isolation
